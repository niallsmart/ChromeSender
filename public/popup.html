<html>
<head>

    <title>ChromeSender</title>

    <script src="/js/vendor/underscore.js"></script>
    <script src="/js/vendor/jquery-1.7.1.min.js"></script>
    <script src="/js/vendor/jquery-ui-1.8.16.custom.min.js"></script>
    <script src="/js/vendor/backbone.js"></script>

    <script src="/js/jquery-extensions.js"></script>
    <script src="/js/send.js"></script>

    <link rel="stylesheet" href="/css/send.css" type="text/css">
    <link rel="stylesheet" href="/css/vendor/jquery-ui-1.8.16.custom.css" type="text/css">

    <script>

        availableItems = [
            "\"Cormac Driver\" <cormac.driver@gmail.com>",
            "\"Michael Donohoe\" <donohoe@gmail.com>",
            "\"Kathryn Smart\" <kathryn.smart@gmail.com>",
            "\"John Smart\" <john.smart@gmail.com>",
            "\"Niall Smart\" <niall@pobox.com>",
            "\"Niall Smart\" <niall.smart@gmail.com>",
            "\"Michael Cohen\" <michaelcohen@realnetworks.edu>",
            "\"Michaelkjasldkj asldkj aslkdj alkjasdj asdjklasdj lasdj slkdj alksjd alksdj laksjd Cohen\" <michaelcohen@realnetworks.edu>",
            "\"Jeff Chasen\" <jchasen@realnetworks.edu>",
            "\"John Schussler\" <jschulssler@realnetworks.edu>",
            "\"Judy Bitterli\" <jbitterli@realnetworks.edu>",
            "\"Richard Wolpert\" <rolpwert@realnetworks.edu>",
            "\"Alan Murphy\" <alan.murphy@gmail.com>",
            "\"Paul French\" <paul.french@gmail.com>",
            "\"Daniel Strickland\" <stricko@gmail.com>"
        ];

        availableItems.sort();

        source = function(req, resp) {
            console.log(req);
            resp(availableItems);
        };

        $(function() {
            window.ac = new EMailAutoComplete({
                el: "#recipients",
                source: availableItems,
                minEditorWidth: 1024
            });

            ac.editor.focus();

            prepareDefaultMessage();
        });

        function prepareDefaultMessage() {

            var activeTabId;

            if (!window.chrome || !window.chrome.tabs) {
                setSelectionInfo({
                    title: "fake title",
                    href: "http://fake.com",
                    selection: "Dog bites man!"
                });
                return;
            }

            activeTabId = parseInt(localStorage.activeTabId, 0);

            chrome.tabs.sendRequest(activeTabId, {method: "getSelectionInfo"}, setSelectionInfo);
        }

        function setSelectionInfo(response) {

            var message = "\n\n" + response.href;

            if (response.selection) {
                message += "\n\n" + response.selection
            }

            $("#subject input").val(response.title);
            $("#message textarea").val(message);
        }

    </script>

</head>
<body onload="">

<table class="form">
    <tr>
        <th>
            To:
        </th>
        <td>
            <div id="recipients" class="wrapper">
                <input type="text" name="receipient" class="editor" placeholder='name or email'>
            </div>
        </td>
    </tr>
    <tr>
        <th>
            Subject:
        </th>
        <td>
            <div id="subject" class="wrapper">
                <input type="text" name="subject" placeholder='subject' autocomplete="off">
            </div>
        </td>
    </tr>
    <tr>
        <th>
            Message:
        </th>
        <td>
            <div id="message" class="wrapper">
                <textarea name="message" columns="10" placeholder="your message"></textarea>
            </div>
        </td>
    </tr>
    <tr class="buttons">
        <td colspan="2">
            <input type="submit" name="Cancel" value="Cancel">
            <input type="submit" name="Send" value="Send">
        </td>
    </tr>
</table>


</body>
</html>


